# 쿼리 메소드 기능 메모 사항들

## 쿼리 메소드 사용 3가지
- 메소드 이름으로 쿼리 생성
- 메소드 이름으로 JPA NamedQuery 호출
- `@Query` 어노테이션을 사용해서 리파지토리 인터페이스에 쿼리 직접 정의

## @Query 특징
- 메소드 이름으로 쿼리 생성 시 파라미터가 많을 경우 메소드 이름이 길어질 수 있다.
- 따라서 메소드 이름은 짧게, 쿼리는 인터페이스에서 직접 작성하여, 쉽게 사용할 수 있다.
- 쿼리에서 오타가 나도 애플리케이션 로딩 시점에 오류를 찾아준다.(NamedQuery의 장점을 그대로 가져옴)
- 동적 쿼리는 QueryDsl을 써야한다.

## 반환 타입
- repository에서 타입을 지정해주면 그에 맞게 반환해준다.
- 반환 타입이 list인 경우, 없는 값을 조회하면 빈 리스트를 반환해준다.(에러 발생 X)
- 반환 타입이 list가 아닌 경우, 없는 값을 조회하면 null을 반환해준다.(에러 발생 X)
- 반환 갯수가 1개를 기대하는데 2개 이상이면 예외를 터트린다.(spring 예외로 변환한다.(repository의 종류가 다양하므로 하나로 통일))

## 페이징
- PageRequest pageRequest = PageRequest.of(0, 3, Sort.by(Sort.Direction.DESC, "username"));
- 찾을 페이지, 페이지 당 담을 갯수, 정렬방식
- -> total 값도 같이 출력된다.(Total을 이용하여 paging 하기 때문)

## 슬라이스
- 페이징과 다르게 전체 갯수를 파악하지 않아 성능이 좋다.
- 다음 페이지만 있는지 확인한다.
- 무한 스크롤 등에 용이하다.

## 벌크성 수정 쿼리
- 벌크 연산은 영속성 컨텍스트를 무시하고 쿼리를 바로 날린다.
- 따라서 영속성 컨텍스트를 비우지 않으면 업데이트 전 데이터가 반영될 수 있다.